services:
  jobtrak-api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: jobtrak-api
    ports:
      - "8000:8000"
    volumes:
      - .:/app
      - ./database:/app/database
      - ./output:/app/output
      - ./logs:/app/logs
    restart: unless-stopped
    networks:
      - infra-network  # Connects to shared infra
    environment:
      - PYTHONPATH=/app
      - PYTHONUNBUFFERED=1
      # --- Database configuration (Pointing to infra-postgres) ---
      - DATABASE_URL=postgresql://postgres:postgres@infra-postgres:5432/postgres
      - POSTGRES_HOST=infra-postgres
      - POSTGRES_PORT=5432
      - POSTGRES_DB=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres

      # --- Redis configuration (Pointing to infra-redis) ---
      - REDIS_URL=redis://infra-redis:6379/0
      - REDIS_HOST=infra-redis
      - REDIS_PORT=6379
      
      # --- Other Settings ---
      - SELENIUM_REMOTE_URL=http://selenium-chrome:4444/wd/hub
      - OPENAI_API_KEY=your_openai_api_key
      - MODEL_NAME=gpt-4.1-mini

networks:
  infra-network:
    external: true  # Tells Docker this network is managed by your infra compose